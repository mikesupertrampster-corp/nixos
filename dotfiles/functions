assume() {
  arn=$1
  aws_sts=$(aws sts assume-role --role-arn $arn --role-session-name "$(whoami)")
  export AWS_ACCESS_KEY_ID=$(echo $aws_sts | jq -r '.Credentials.AccessKeyId')
  export AWS_SECRET_ACCESS_KEY=$(echo $aws_sts | jq -r '.Credentials.SecretAccessKey')
  export AWS_SESSION_TOKEN=$(echo $aws_sts | jq -r '.Credentials.SessionToken')
}

awshosts() {
  ENV=$1
  NAME=$2
  aws ec2 describe-instances --profile $ENV --output table \
    --filters "Name=tag:Name,Values=$NAME" "Name=instance-state-name,Values=[running,pending,shutting-down,stopping]" \
    --query "Reservations[].Instances[].{AZ:Placement.AvailabilityZone,ID:InstanceId,Type:Tags[?Key=='Name']|[0].Value,IP:PrivateIpAddress,InstanceType:InstanceType,Launched:LaunchTime,State:State.Name} | sort_by(@, &Type)"
}

clearssh() {
  unset SSH_AUTH_SOCK
  eval $(ssh-agent)
}

ol_creds() {
  export ONELOGIN_CLIENT_ID=$(pass mettle/onelogin/sandbox/id)
  export ONELOGIN_CLIENT_SECRET=$(pass mettle/onelogin/sandbox/secret)
  export ONELOGIN_OAPI_URL=https://api.eu.onelogin.com
}

gh_creds() {
  export GITHUB_TOKEN=$(pass mettle/github/pat)
}

ib_creds() {
  export IB_USER=$(pass ib/user)
  export IB_PASS=$(pass ib/pass)
}

branch() {
  git stash
  git checkout master
  git pull
  git checkout -b $1
  git stash pop
}

gang() {
  firefox "https://gangway.oidc.$1-$(pass mettle/domain)/login"
  sleep 5
  firefox "https://gangway.oidc.$1-$(pass mettle/domain)/kubeconf"
  sleep 5
  mv ~/Downloads/kubeconf ~/.kube/mettle-$1
  chmod go-r ~/.kube/mettle-$1
  kenv $1
}

kenv() {
  export KUBECONFIG=~/.kube/mettle-$1
}

mon() {
  ~/.screenlayout/default.sh
  ~/.config/polybar/launch.sh
}